# Cortex-M23 命令セット仕様

Cortex-M23プロセッサはARMv8-Mベースライン命令セットを完全に実装しています。以下は実装されている命令の一覧とそのサイクル数です。
サイクル数はAHBバスにウェイトステートがない場合の値です。

## データ操作命令

### 移動命令 (Move)
| 命令 | 説明 | アセンブラ構文 | サイクル数 |
|------|------|----------------|------------|
| 8ビット即値移動 | 即値をレジスタに移動 | `MOVS <Rd>, #<imm>` | 1 |
| Lo-Loレジスタ間移動 | Lo-Loレジスタ間の移動 | `MOVS <Rd>, <Rm>` | 1 |
| 任意レジスタ間移動 | 任意レジスタ間の移動 | `MOV <Rd>, <Rm>` | 1 |
| PCへの移動 | レジスタからPCへの移動 | `MOV PC, <Rm>` | 2 |
| Top移動 | 上位ビットの移動 | `MOVT <Rd>, #<imm>` | 3 |
| Wide移動 | ワイド即値の移動 | `MOVW <Rd>, #<imm>` | 3 |

### 算術演算命令
| 命令 | 説明 | アセンブラ構文 | サイクル数 |
|------|------|----------------|------------|
| 加算 (3ビット即値) | 即値加算 | `ADDS <Rd>, <Rn>, #<imm>` | 1 |
| レジスタ間加算 | レジスタ値の加算 | `ADDS <Rd>, <Rn>, <Rm>` | 1 |
| キャリー付き加算 | キャリーフラグを含む加算 | `ADCS <Rd>, <Rd>, <Rm>` | 1 |
| SPからの加算 | SPを基準とした加算 | `ADD <Rd>, SP, #<imm>` | 1 |
| 減算 | レジスタ間の減算 | `SUBS <Rd>, <Rn>, <Rm>` | 1 |
| キャリー付き減算 | キャリーフラグを含む減算 | `SBCS <Rd>, <Rd>, <Rm>` | 1 |
| 否定 | レジスタ値の否定 | `RSBS <Rd>, <Rn>, #0` | 1 |

### 乗算・除算命令
| 命令 | 説明 | アセンブラ構文 | サイクル数 |
|------|------|----------------|------------|
| 乗算 | レジスタ間の乗算 | `MULS <Rd>, <Rm>, <Rd>` | 1または32* |
| 符号なし除算 | 符号なし32ビット除算 | `UDIV {<Rd>,} <Rn>, <Rm>` | 17または34** |
| 符号付き除算 | 符号付き32ビット除算 | `SDIV {<Rd>,} <Rn>, <Rm>` | 17または34** |

*: 乗算器の実装による
**: 除算器の実装による

### 論理演算命令
| 命令 | 説明 | アセンブラ構文 | サイクル数 |
|------|------|----------------|------------|
| AND | 論理積 | `ANDS <Rd>, <Rd>, <Rm>` | 1 |
| XOR | 排他的論理和 | `EORS <Rd>, <Rd>, <Rm>` | 1 |
| OR | 論理和 | `ORRS <Rd>, <Rd>, <Rm>` | 1 |
| ビットクリア | ビットクリア | `BICS <Rd>, <Rd>, <Rm>` | 1 |
| NOT | ビット反転 | `MVNS <Rd>, <Rm>` | 1 |

### シフト・回転命令
| 命令 | 説明 | アセンブラ構文 | サイクル数 |
|------|------|----------------|------------|
| 論理左シフト | 即値による左シフト | `LSLS <Rd>, <Rm>, #<shift>` | 1 |
| 論理右シフト | 即値による右シフト | `LSRS <Rd>, <Rm>, #<shift>` | 1 |
| 算術右シフト | 符号を保持した右シフト | `ASRS <Rd>, <Rm>, #<shift>` | 1 |
| 右回転 | レジスタによる右回転 | `RORS <Rd>, <Rd>, Rs` | 1 |

## メモリアクセス命令

### ロード命令
| 命令 | 説明 | アセンブラ構文 | サイクル数 |
|------|------|----------------|------------|
| ワードロード | メモリからワードをロード | `LDR <Rd>, [<Rn>, #<imm>]` | 2または1* |
| ハーフワードロード | メモリからハーフワードをロード | `LDRH <Rd>, [<Rn>, #<imm>]` | 2または1* |
| バイトロード | メモリからバイトをロード | `LDRB <Rd>, [<Rn>, #<imm>]` | 2または1* |
| 複数ロード | 複数レジスタへのロード | `LDM <Rn>!, {<loreglist>}` | 1+N** |

### ストア命令
| 命令 | 説明 | アセンブラ構文 | サイクル数 |
|------|------|----------------|------------|
| ワードストア | レジスタ値をメモリに格納 | `STR <Rd>, [<Rn>, #<imm>]` | 2または1* |
| ハーフワードストア | ハーフワードをメモリに格納 | `STRH <Rd>, [<Rn>, #<imm>]` | 2または1* |
| バイトストア | バイトをメモリに格納 | `STRB <Rd>, [<Rn>, #<imm>]` | 2または1* |
| 複数ストア | 複数レジスタの値を格納 | `STM <Rn>!, {<loreglist>}` | 1+N** |

*: AHBインターフェースまたはSCSの場合は2、シングルサイクルI/Oポートの場合は1
**: Nはリスト内の要素数

## 分岐命令
| 命令 | 説明 | アセンブラ構文 | サイクル数 |
|------|------|----------------|------------|
| 条件分岐 | 条件に基づく分岐 | `B<c> <label>` | 2または1* |
| 無条件分岐 | 無条件の分岐 | `B <label>` | 2 |
| リンク付き分岐 | サブルーチン呼び出し | `BL <label>` | 3 |
| 交換付き分岐 | 状態を変更して分岐 | `BX <Rm>` | 2 |

*: 分岐が実行される場合は2、実行されない場合は1

## システム・特権命令
| 命令 | 説明 | アセンブラ構文 | サイクル数 |
|------|------|----------------|------------|
| スーパーバイザーコール | OS機能呼び出し | `SVC #<imm>` | - |
| 割り込み禁止 | 割り込みの無効化 | `CPSID i` | 1 |
| 割り込み許可 | 割り込みの有効化 | `CPSIE i` | 1 |
| 特殊レジスタ読み出し | システムレジスタ読み出し | `MRS <Rd>, <specreg>` | 3 |
| 特殊レジスタ書き込み | システムレジスタ書き込み | `MSR <specreg>, <Rn>` | 3 |

## バリア命令
| 命令 | 説明 | アセンブラ構文 | サイクル数 |
|------|------|----------------|------------|
| 命令同期バリア | 命令実行の同期 | `ISB` | 3 |
| データメモリバリア | データアクセスの順序付け | `DMB` | 3 |
| データ同期バリア | データアクセスの同期 | `DSB` | 3 |

注意事項:
- Lo: レジスタR0-R7を指します
- Any: レジスタR0-R15を指します
- 全てのサイクル数はウェイトステートなしのシステムを前提としています
- 乗算器と除算器の実装により、実際のサイクル数は異なる場合があります
- 本文書は ARM DDI 0550C に基づいて作成されていますが、<br>理解を助けるために
構成の再構築や補足説明を行っています。<br>正確な仕様については原典を参照してください。

## 参考文献

[1] ARM Limited, "ARM® Cortex®-M23 Processor Technical Reference Manual," 
    ARM DDI 0550C (ID112116), Nov. 2016.
    
[2] ARM Limited, "ARM® v8-M Architecture Reference Manual," 
    ARM DDI 0553, 2016.
